<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ASK / FSK / PSK Simulator</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    padding: 20px;
}
.tab-container { width: 90%; max-width: 900px; margin: auto; }
.tabs { display: flex; margin-bottom: 10px; }
.tab {
    padding: 10px 20px;
    border: 1px solid #ccc;
    background: white;
    cursor: pointer;
    border-bottom: none;
}
.tab.active { background: #007bff; color: white; }
.tab-content { 
    border: 1px solid #ccc;
    background: white;
    padding: 20px;
    border-radius: 0 0 8px 8px;
}
label { font-weight: bold; margin-top: 10px; display: block; }
input { width: 100%; padding: 6px; margin-top: 4px; }

button {
    margin-top: 14px;
    padding: 10px;
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 6px;
}
#plot-area { margin-top: 20px; }
</style>
</head>

<body>

<!-- Small Parameter Guide (copy into your page) -->
<!-- Centered Small Parameter Guide -->
<div class="form-container">
        <h1> ASK / FSK / PSK Simulator</h1>
<div style="display:flex;justify-content:center;margin-top:20px;">
  <div style="display:flex;gap:12px;align-items:flex-start;background:#fff;
              padding:12px;border-radius:8px;border:1px solid #ececec;
              max-width:820px;box-shadow:0 1px 4px rgba(0,0,0,0.08);">

      <div style="font-family:Arial,Helvetica,sans-serif;color:#222;">
        <strong style="display:block;margin-bottom:6px;font-size:15px;">
          Quick Parameter Guide
        </strong>

        <dl style="margin:0;line-height:1.4;color:#444;">
          <dt style="font-weight:700;">fs (Sampling rate)</dt>
          <dd style="margin:0 0 6px 0;font-size:13px;">
            Digital sampling frequency in Hz. Higher ‚Üí better resolution. Typical: <em>1k‚Äì50k Hz</em>.
          </dd>

          <dt style="font-weight:700;">Duration</dt>
          <dd style="margin:0 0 6px 0;font-size:13px;">
            Total simulated time in seconds. Must be ‚â• (bits / bitrate) to include all bits.
          </dd>

          <dt style="font-weight:700;">Bitrate / Bits</dt>
          <dd style="margin:0 0 6px 0;font-size:13px;">
            Bits per second (Tb = 1/bitrate). Bits entered as: <code>1 0 1 1 0</code>.
          </dd>

          <dt style="font-weight:700;">fc, f1, f0</dt>
          <dd style="margin:0 0 6px 0;font-size:13px;">
            Carrier frequency (ASK/PSK). For FSK, use different frequencies for bit 1 and 0.
          </dd>

          <dt style="font-weight:700;">A1, A0 (ASK)</dt>
          <dd style="margin:0;font-size:13px;">
            Carrier amplitude for bit=1 and bit=0. Typical: <em>A1=1, A0=0</em>.
          </dd>
        </dl>
      </div>
  </div>
</div>

<div class="tab-container">

    <div class="tabs">
        <div class="tab active" onclick="switchTab('ASK')">ASK</div>
        <div class="tab" onclick="switchTab('FSK')">FSK</div>
        <div class="tab" onclick="switchTab('PSK')">PSK</div>
    </div>

    <div class="tab-content">

        <form id="mainForm">

            <label>Sampling Frequency (fs)</label>
            <input type="number" id="fs" value="5000">

            <label>Duration (seconds)</label>
            <input type="text" id="duration" value="1">

            <label>Bits (space separated)</label>
            <input type="text" id="bits" value="1 0 1 1 0">

            <label>Bitrate</label>
            <input type="number" id="bitrate" value="5">

            <label>Carrier Frequency (fc)</label>
            <input type="number" id="fc" value="50">

            <!-- FSK only -->
            <div id="fsk-params" style="display:none;">
                <label>Frequency for bit=1 (f1)</label>
                <input type="number" id="f1" value="60">

                <label>Frequency for bit=0 (f0)</label>
                <input type="number" id="f0" value="40">
            </div>

            <!-- ASK only -->
            <div id="ask-params">
                <label>Amplitude for bit=1 (A1)</label>
                <input type="number" id="A1" value="1">

                <label>Amplitude for bit=0 (A0)</label>
                <input type="number" id="A0" value="0">
            </div>

            <button type="button" onclick="runSimulation()">Run Simulation</button>

        </form>

    </div>

    <div id="plot-area"></div>

</div>

<script>
let currentMode = "ASK";

function switchTab(mode) {
    currentMode = mode;

    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelector(`.tab:nth-child(${mode==="ASK"?1:mode==="FSK"?2:3})`).classList.add("active");

    document.getElementById("ask-params").style.display = (mode==="ASK") ? "block" : "none";
    document.getElementById("fsk-params").style.display = (mode==="FSK") ? "block" : "none";

    document.getElementById("plot-area").innerHTML = "";
}

async function runSimulation() {

    let payload = {
        mode: currentMode,
        fs: document.getElementById("fs").value,
        duration: document.getElementById("duration").value,
        bits: document.getElementById("bits").value,
        bitrate: document.getElementById("bitrate").value,
        fc: document.getElementById("fc").value,
        f1: document.getElementById("f1")?.value,
        f0: document.getElementById("f0")?.value,
        A1: document.getElementById("A1")?.value,
        A0: document.getElementById("A0")?.value
    };

    let res = await fetch("/ask", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
    });

    let out = await res.json();

    if (out.error) {
        document.getElementById("plot-area").innerHTML =
            `<p style="color:red;">Error: ${out.error}</p>`;
        return;
    }

    document.getElementById("plot-area").innerHTML = out.plot_html;
}

</script>
<div class="assistant-container">
    <h3>üß† Wikipedia Assistant</h3>
    <p>Learn about Amplitude Shift Keying, Frequency Shift Keying, Phase Shift Keying.</p>

    <textarea id="wiki-query" rows="3" style="width:100%;">Amplitude Shift Keying, Frequency Shift Keying, Phase Shift Keying. </textarea><br>
    <button type="button" onclick="searchWiki()" class="btn-primary">Search Wikipedia</button>
    <button type="button" onclick="refreshWiki()" class="btn-secondary" style="margin-left:8px;">üîÑ Refresh</button>

    <div id="wiki-result">‚è≥ Loading Wikipedia data...</div>
</div>

<script>
async function searchWiki() {
    const q = document.getElementById("wiki-query").value.trim();
    const out = document.getElementById("wiki-result");
    if (!q) { out.innerHTML="‚ùå Enter a query."; return; }
    out.innerHTML="‚è≥ Fetching data...";
    try {
        const url = `https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&generator=search&gsrsearch=${encodeURIComponent(q)}&gsrlimit=2&prop=extracts&exintro=true&explaintext=true`;
        const r = await fetch(url);
        const data = await r.json();
        if (!data.query) return out.innerHTML="‚ùå No results.";
        const pages = Object.values(data.query.pages).sort((a,b)=>a.index-b.index);
        let html="";
        for (const p of pages) {
            const desc = (p.extract||"").split(/(?<=\.)\s+/).slice(0,3).join(" ");
            html+=`
                <h4 style="color:#0066cc;">${p.title}</h4>
                <p>${desc}</p>
                <a href="https://en.wikipedia.org/?curid=${p.pageid}" target="_blank">üîó Read more</a>
                <hr class="small">`;
        }
        out.innerHTML = html + `<p style="text-align:center;color:#666">‚Äî End ‚Äî</p>`;
    } catch {
        out.innerHTML="‚ö†Ô∏è Error fetching Wikipedia content.";
    }
}
function refreshWiki(){ document.getElementById("wiki-result").innerHTML="üîÅ Refreshing..."; setTimeout(searchWiki,600); }
window.onload = searchWiki;
</script>

</body>
</html>
